---
# AGENTS.md

このリポジトリはSCP-MCPを開発するためのコードベースです。
AI コーディングエージェント（claude/Codex 等）は、本ファイルの指示を「最優先の作業規約」として扱ってください。
---

## 開発規則

### 1) ドキュメントを真実源（SSoT）として扱う

- **仕様・設計ドキュメントがコードより上位**。矛盾が出たらコードではなくドキュメント側に合わせる。
- 実装・PRは必ず **該当ドキュメントの章/項番** を参照する（PR本文にリンク/パス＋セクション名を明記）。
- ドキュメントに書かれていない要件・挙動は実装しない（推測で埋めない）。
- 仕様変更は **ドキュメント更新が先**。更新なしの挙動変更は禁止。

### 2) t-wada式TDDを厳守

- 原則 **Red → Green → Refactor** を崩さない。
- 変更は最小ステップで刻む（1サイクルで触る範囲を限定）。
- テストが落ちている状態でのリファクタ禁止、`skip`/`only` の恒久化禁止（例外は期限つきで明文化）。

### 3) PR / コミット規約

- `main`（または統合ブランチ）への **直コミット禁止**。変更はすべてPR経由。
- **1PR = 1目的**。無関係な変更・フォーマット変更の混入を禁止。
- PR本文に必ず記載：
  - 参照したドキュメント（パス＋セクション）
  - 変更の意図（何を満たすための変更か）
  - 影響範囲/リスク（壊れる可能性がある箇所）
  - 実行したテスト（コマンドと結果）

- コミットは「テストが通る最小単位」で積む。WIPコミットを統合ブランチに残さない。
- 以後、main への取り込み方針を以下で固定する（例外なし）。
  - **main は Squash merge のみ**（＝main上は PRあたり1コミット）
  - **Merge commitは禁止**（`Merge pull request ...` / `Merge main into ...` を作らない）
  - ブランチ追従は **rebase** で行う（例: `git fetch origin && git rebase origin/main` 後に `git push --force-with-lease`）
  - **Squash後のコミットメッセージはPRタイトル**をそのまま使う。PRタイトルは **Conventional Commits**（例: `feat(t6): collect PR data`）
  - マージは **GitHub CLI の squash 指定**で行う: `gh pr merge <PR番号> --squash`（`--delete-branch` は付けない）
  - マージ前提: **CI のチェックが報告済み**で、CI green かつ lint / typecheck / test が通っていること
  - **マージ直前に** `gh pr checks <PR番号>` でチェックが出ていることを確認する（`no checks reported` のままマージ禁止）

### 4) ユーザー要求の強度と対応

#### 1. 質問

- ユーザーは情報の提供を求めている。
- 実装の修正やドキュメント変更を求めているわけではない。
- 回答時には「間違っていました」や「修正します」といった反応をせず、**質問に直接答える**こと。
- 例：「〜ですか？」「〜なの？」

#### 2. 弱い要求

- ユーザーは「可能であれば対応してほしい」と考えている。
- コスト・リスクに問題がなければ対応を実行する。
- 問題がある場合はその内容と重要度を伝え、判断を仰ぐこと。
- 例：「〜してもらえますか？」「〜は可能ですか？」

#### 3. 強い要求

- ユーザーは明確に修正や編集を依頼している。
- 重大なコスト・リスクがない限り、必ず対応を実行する。
- 問題がある場合は、その内容を伝え判断を仰ぐこと。
- 例：「〜してください」「〜しなさい」

### 5) 作業計画とPR運用

- いきなりファイル編集などの作業は行わない。作業を始める前に必ず作業計画書を作成し、作業内容をドキュメントとして残したうえで実作業に入る。
- 作業計画書は `docs/plan/` に格納する（例: `docs/plan/作業計画書_YYYY-MM-DD_*.md`）。
- 1目的の作業（1PRで完結する作業）は、作業計画書（ドキュメント更新）と実作業（コード変更など）を同じPRにコミットする。
- 複数PRが必要な作業は、先に作業計画書を作成するためのドキュメント更新専用PRを作り、計画を確定させてから後続のPRを作成する。
- 作業計画書に基づいて作業を進める場合、各タスクが完了した時点で、作業計画書の該当箇所に**チェックマーク（✓）**を付けて更新する。

### 5) 応答言語

- 英語で思考し、日本語で応答してください。

---
